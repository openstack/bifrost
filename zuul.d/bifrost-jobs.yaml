- nodeset:
    name: bifrost-centos-10-stream
    nodes:
      - name: primary
        label: centos-10-stream-8GB

- nodeset:
    name: bifrost-ubuntu-noble-8GB
    nodes:
      - name: primary
        label: ubuntu-noble-8GB

- job:
    name: bifrost-base
    parent: base
    irrelevant-files:
      - ^.*\.rst$
      - ^api-ref/.*$
      - ^bifrost/tests/.*$
      - ^doc/.*$
      - ^ironic/locale/.*$
      - ^ironic/tests/.*$
      - ^releasenotes/.*$
      - ^setup.cfg$
      - ^test-requirements.txt$
      - ^tools/.*$
      - ^tox.ini$
    pre-run: playbooks/ci/pre.yaml
    run: playbooks/ci/run.yaml
    post-run: playbooks/ci/post.yaml
    required-projects:
      - openstack/bifrost
      - openstack/diskimage-builder
      - openstack/ironic
      - openstack/ironic-python-agent
      - openstack/ironic-python-agent-builder
      - openstack/requirements

- job:
    name: bifrost-integration
    parent: bifrost-base

- job:
    name: bifrost-integration-dhcp
    parent: bifrost-integration
    timeout: 7200
    vars:
      use_dhcp: true
      noauth_mode: true

- job:
    name: bifrost-integration-dhcp-ubuntu-jammy
    parent: bifrost-integration-dhcp
    nodeset: ubuntu-jammy

- job:
    name: bifrost-integration-dhcp-centos-10
    parent: bifrost-integration-dhcp
    nodeset: bifrost-centos-10-stream

- job:
    name: bifrost-integration-debian-ipasrc
    parent: bifrost-integration
    timeout: 7200
    vars:
      build_image: true
      # NOTE(dtantsur): these jobs have weird issues with IPMI. Since IPMI is
      # not what we want to test here, just use Redfish.
      test_driver: redfish

- job:
    name: bifrost-integration-debian-ipasrc-on-ubuntu-jammy
    parent: bifrost-integration-debian-ipasrc
    nodeset: ubuntu-jammy

- job:
    name: bifrost-integration-debian-ipasrc-on-centos-10
    parent: bifrost-integration-debian-ipasrc
    nodeset: bifrost-centos-10-stream

- job:
    name: bifrost-integration-on-ubuntu-jammy
    parent: bifrost-integration
    nodeset: ubuntu-jammy
    timeout: 7200

- job:
    name: bifrost-integration-on-ubuntu-noble
    parent: bifrost-integration
    nodeset: bifrost-ubuntu-noble-8GB
    timeout: 7200

- job:
    name: bifrost-integration-keystone-on-ubuntu-jammy
    parent: bifrost-integration
    nodeset: ubuntu-jammy
    timeout: 7200
    required-projects:
      - openstack/keystone
      - openstack/ironic-prometheus-exporter
    vars:
      enable_keystone: true
      enable_tls: true
      test_driver: redfish
      enable_prometheus_exporter: true

- job:
    name: bifrost-integration-keystone-on-ubuntu-noble
    parent: bifrost-integration-keystone-on-ubuntu-jammy
    nodeset: bifrost-ubuntu-noble-8GB
    timeout: 7200

- job:
    name: bifrost-integration-redfish-vmedia-uefi-ubuntu-noble
    parent: bifrost-integration-on-ubuntu-noble
    nodeset: bifrost-ubuntu-noble-8GB
    vars:
      enable_tls: true
      test_driver: redfish
      use_vmedia: true

- job:
    name: bifrost-integration-redfish-vmedia-uefi-ubuntu-jammy
    parent: bifrost-integration-on-ubuntu-jammy
    vars:
      enable_tls: true
      test_driver: redfish
      use_vmedia: true

- job:
    name: bifrost-cli-ubuntu-jammy
    parent: bifrost-integration-on-ubuntu-jammy
    vars:
      cli_test: true

- job:
    name: bifrost-integration-redfish-vmedia-uefi-centos-10
    parent: bifrost-integration-on-centos-10
    vars:
      test_driver: redfish
      use_vmedia: true

- job:
    name: bifrost-integration-redfish-pxe-uefi-ubuntu-noble
    parent: bifrost-integration-on-ubuntu-noble
    vars:
      enable_grub_network_boot: true
      test_driver: redfish

- job:
    name: bifrost-integration-on-centos-10
    parent: bifrost-integration
    nodeset: bifrost-centos-10-stream
    timeout: 7200

- job:
    name: bifrost-integration-keystone-on-centos-10
    parent: bifrost-integration-on-centos-10
    required-projects:
      - openstack/keystone
      - openstack/ironic-prometheus-exporter
    vars:
      enable_keystone: true
      enable_tls: true
      test_driver: redfish
      enable_prometheus_exporter: true

- job:
    name: bifrost-integration-on-debian-bookworm
    parent: bifrost-integration
    nodeset: debian-bookworm
    timeout: 7200

- job:
    name: bifrost-integration-redfish-vmedia-uefi-debian-bookworm
    parent: bifrost-integration-on-debian-bookworm
    vars:
      enable_tls: true
      test_driver: redfish
      use_vmedia: true

- job:
    name: bifrost-tox-linters
    parent: openstack-tox-linters
    required-projects:
      - openstack/ansible-collections-openstack

- job:
    name: bifrost-upgrade
    parent: bifrost-base
    run: playbooks/ci/upgrade.yaml
    timeout: 9600
    vars:
      upgrade_from: stable/2025.2
      skip_upgrade:
        - openstack/diskimage-builder

- job:
    name: bifrost-upgrade-ubuntu-jammy
    parent: bifrost-upgrade
    nodeset: ubuntu-jammy

- job:
    name: bifrost-upgrade-keystone-centos-10
    parent: bifrost-upgrade
    nodeset: bifrost-centos-10-stream
    required-projects:
      - openstack/keystone
    vars:
      enable_keystone: true
      noauth_mode: false

- job:
    name: bifrost-upgrade-keystone-ubuntu-noble
    parent: bifrost-upgrade
    nodeset: bifrost-ubuntu-noble-8GB
    timeout: 7200
    required-projects:
      - openstack/keystone
    vars:
      enable_keystone: true
      noauth_mode: false

- job:
    name: bifrost-slurp-upgrade
    parent: bifrost-upgrade
    vars:
      upgrade_from: stable/2025.1

- job:
    name: bifrost-slurp-upgrade-ubuntu-jammy
    parent: bifrost-slurp-upgrade
    nodeset: ubuntu-jammy

# NOTE(TheJulia): This job is for use on the ironic repository,
# to provide a minimal platform where we can execute a job where
# basic performance numbers will be referenced/collected.
# Notes are being kept on https://etherpad.opendev.org/p/ironic-performance
- job:
    name: bifrost-benchmark-ironic
    parent: bifrost-base
    nodeset: ubuntu-jammy
    timeout: 7200
    run: playbooks/ci/benchmark-ironic.yaml


- job:
    name: bifrost-tox-codespell
    parent: openstack-tox
    timeout: 7200
    vars:
      tox_envlist: codespell
